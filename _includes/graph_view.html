<div>
    <div id="graph"></div>
    <div id="tooltip" style="position: absolute; visibility: hidden; background: lightsteelblue; padding: 5px; border-radius: 4px; pointer-events: none;"></div>
    <script>
    fetch('/assets/graph.json')
    .then(response => response.json())
    .then(data => {
        const width = 600;
        const height = 400;

        const svg = d3.select("#graph")
            .append("svg")
            .attr("width", width)
            .attr("height", height);

        const tooltip = d3.select("#tooltip");

        const simulation = d3.forceSimulation(data.nodes)
            .force("link", d3.forceLink(data.links).id(d => d.id))
            .force("charge", d3.forceManyBody())
            .force("center", d3.forceCenter(width / 2, height / 2));

        const link = svg.append("g")
            .attr("class", "links")
            .selectAll("line")
            .data(data.links)
            .enter().append("line")
            .attr("class", "link");

        const node = svg.append("g")
            .attr("class", "nodes")
            .selectAll("circle")
            .data(data.nodes)
            .enter().append("circle")
            .attr("class", "node")
            .attr("r", 5)
                .on("mouseover", function(event, d) {
                tooltip.style("visibility", "visible")
                    .text(d.id);  // 툴팁에 노드의 ID 표시
            })
            .on("mousemove", function(event) {
                tooltip.style("top", (event.pageY + 5) + "px") // 마우스 위치에 따라 툴팁 위치 조정
                        .style("left", (event.pageX + 5) + "px");
            })
            .on("mouseout", function() {
                tooltip.style("visibility", "hidden"); // 마우스가 나갈 때 툴팁 숨김
            })
            .on("click", function(event, d) {
                console.log("Clicked node:", d.id); // 클릭된 노드 ID 로그
                const relatedPost = data.links.find(link => link.source === d.id);
                console.log("Related post:", relatedPost); // 관련 링크 로그
                                    
                const targetUrl = `/posts/${d.self}`; // `/posts/` 경로 추가
                window.location.href = targetUrl; // 같은 탭에서 링크로 이동
            });

        simulation
            .nodes(data.nodes)
            .on("tick", ticked);

        simulation.force("link")
            .links(data.links);
        function ticked() {
            link
                .attr("x1", d => d.source.x)
                .attr("y1", d => d.source.y)
                .attr("x2", d => d.target.x)
                .attr("y2", d => d.target.y);

            node
                .attr("cx", d => d.x)
                .attr("cy", d => d.y);
        }
    })
    .catch(error => console.error('Error loading or parsing data:', error));
    </script>
</div>